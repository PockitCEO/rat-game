{"version":3,"sources":["../src/errors/InvalidJsonError.js","../src/errors/ReadRequestBodyError.js","../src/internal/getRequestBody.js","../src/internal/handleBulkRequest.js","../src/internal/handleError.js","../src/internal/parseRequest.js","../src/createHttpHandler.js","../src/adapters/createExpressMiddleware.js","../src/adapters/createNextApiHandler.js","../src/createServer.js"],"names":["BaseError","tevmSend","InternalError","z","InvalidRequestError","treeifyError","UnsupportedProviderMethodError","MethodNotFoundError","httpCreateServer"],"mappings":"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","file":"index.cjs","sourcesContent":["import { BaseError } from '@tevm/errors'\n\n/**\n * Parameters for constructing an {@link InvalidJsonError}.\n * @typedef {Object} InvalidJsonErrorParameters\n * @property {string} [docsBaseUrl] - Base URL for the documentation.\n * @property {string} [docsPath] - Path to the documentation.\n * @property {string} [docsSlug] - Slug for the documentation.\n * @property {string[]} [metaMessages] - Additional meta messages.\n * @property {import('@tevm/errors').BaseError|Error} [cause] - The cause of the error.\n * @property {string} [details] - Details of the error.\n * @property {object} [meta] - Optional object containing additional information about the error.\n */\n\n/**\n * Represents an error that occurs when parsing JSON fails.\n *\n * This error is typically encountered when there is an issue with the JSON structure, such as a syntax error or malformed JSON.\n *\n * @example\n * try {\n *   const data = parseJsonWithSomeTevmMethod(someString)\n * } catch (error) {\n *   if (error instanceof InvalidJsonError) {\n *     console.error(error.message);\n *     // Handle the invalid JSON error\n *   }\n * }\n *\n * @param {string} message - A human-readable error message.\n * @param {InvalidJsonErrorParameters} [args={}] - Additional parameters for the InvalidJsonError.\n * @property {'InvalidJsonError'} _tag - Same as name, used internally.\n * @property {'InvalidJsonError'} name - The name of the error, used to discriminate errors.\n * @property {string} message - Human-readable error message.\n * @property {object} [meta] - Optional object containing additional information about the error.\n * @property {number} code - Error code, analogous to the code in JSON RPC error.\n * @property {string} docsPath - Path to the documentation for this error.\n * @property {string[]} [metaMessages] - Additional meta messages for more context.\n */\nexport class InvalidJsonError extends BaseError {\n\t/**\n\t * Constructs an InvalidJsonError.\n\t *\n\t * @param {string} message - Human-readable error message.\n\t * @param {InvalidJsonErrorParameters} [args={}] - Additional parameters for the InvalidJsonError.\n\t */\n\tconstructor(message, args = {}) {\n\t\tsuper(\n\t\t\tmessage,\n\t\t\t{\n\t\t\t\t...args,\n\t\t\t\tdocsBaseUrl: 'https://tevm.sh',\n\t\t\t\tdocsPath: '/reference/tevm/errors/classes/invalidjsonerror/',\n\t\t\t},\n\t\t\t'InvalidJsonError',\n\t\t\t-32700,\n\t\t)\n\t}\n}\n","import { BaseError } from '@tevm/errors'\n\n/**\n * Parameters for constructing a {@link ReadRequestBodyError}.\n * @typedef {Object} ReadRequestBodyErrorParameters\n * @property {string} [docsBaseUrl] - Base URL for the documentation.\n * @property {string} [docsPath] - Path to the documentation.\n * @property {string} [docsSlug] - Slug for the documentation.\n * @property {string[]} [metaMessages] - Additional meta messages.\n * @property {import('@tevm/errors').BaseError|Error} [cause] - The cause of the error.\n * @property {string} [details] - Details of the error.\n * @property {object} [meta] - Optional object containing additional information about the error.\n */\n\n/**\n * Represents an error that occurs when reading the request body from an HTTP request fails.\n *\n * This error is typically encountered when there is an issue with reading the request body, such as a network error or a problem with the incoming request stream.\n * @param {string} message - A human-readable error message.\n * @param {ReadRequestBodyErrorParameters} [args={}] - Additional parameters for the ReadRequestBodyError.\n * @property {'ReadRequestBodyError'} _tag - Same as name, used internally.\n * @property {'ReadRequestBodyError'} name - The name of the error, used to discriminate errors.\n * @property {string} message - Human-readable error message.\n * @property {object} [meta] - Optional object containing additional information about the error.\n * @property {number} code - Error code, analogous to the code in JSON RPC error.\n * @property {string} docsPath - Path to the documentation for this error.\n * @property {string[]} [metaMessages] - Additional meta messages for more context.\n */\nexport class ReadRequestBodyError extends BaseError {\n\t/**\n\t * Constructs a ReadRequestBodyError.\n\t *\n\t * @param {string} message - Human-readable error message.\n\t * @param {ReadRequestBodyErrorParameters} [args={}] - Additional parameters for the ReadRequestBodyError.\n\t */\n\tconstructor(message, args = {}) {\n\t\tsuper(\n\t\t\tmessage,\n\t\t\t{\n\t\t\t\t...args,\n\t\t\t\tdocsBaseUrl: 'https://tevm.sh',\n\t\t\t\tdocsPath: '/reference/tevm/errors/classes/readrequestbodyerror/',\n\t\t\t},\n\t\t\t'ReadRequestBodyError',\n\t\t)\n\t}\n}\n","import { ReadRequestBodyError } from '../errors/ReadRequestBodyError.js'\n\n/**\n * Gets request body from an http request.\n * @param {import('http').IncomingMessage|{body: string}} req The request object\n * @returns {Promise<string | ReadRequestBodyError>} Request body as a promise\n * @throws {never} returns errors as value\n */\nexport const getRequestBody = (req) => {\n\t// If the request already has a body property, return it\n\tif ('body' in req && req.body !== undefined) {\n\t\treturn Promise.resolve(req.body)\n\t}\n\n\t// Otherwise, read from the stream\n\treturn new Promise((resolve) => {\n\t\tlet body = ''\n\n\t\tif ('on' in req) {\n\t\t\treq.on('error', (err) => {\n\t\t\t\tresolve(new ReadRequestBodyError(err.message, { cause: err }))\n\t\t\t})\n\t\t\treq.on('data', (chunk) => {\n\t\t\t\tbody += chunk.toString()\n\t\t\t})\n\n\t\t\treq.on('end', () => {\n\t\t\t\treturn resolve(body)\n\t\t\t})\n\t\t} else {\n\t\t\t// Should never happen, but needed for type safety\n\t\t\tresolve(new ReadRequestBodyError('Request object is not a valid stream', {}))\n\t\t}\n\t})\n}\n","import { tevmSend } from '@tevm/decorators'\nimport { InternalError } from '@tevm/errors'\n\n/**\n * Handles a bulk request. Does not throw returns errors as json-rpc error responses\n * @param {import('../Client.js').Client} client\n * @param {ReadonlyArray<import(\"@tevm/jsonrpc\").JsonRpcRequest<string, any>>} requests\n * @returns {Promise<ReadonlyArray<import(\"@tevm/jsonrpc\").JsonRpcResponse<any, any, any>>>}\n * @throws {never} never throws\n */\nexport const handleBulkRequest = async (client, requests) => {\n\tconst { send } = client.transport.tevm.extend(tevmSend())\n\tconst responses = await Promise.allSettled(\n\t\trequests.map((request) => {\n\t\t\treturn send(/** @type any*/ (request))\n\t\t}),\n\t)\n\treturn responses.map((response, i) => {\n\t\tconst request = /** @type {import(\"@tevm/jsonrpc\").JsonRpcRequest<string, object>} */ (requests[i])\n\t\tif (response.status === 'rejected') {\n\t\t\tclient.transport.tevm.logger.error(response.reason)\n\t\t\tconst err = new InternalError(request.method, { cause: response.reason })\n\t\t\treturn {\n\t\t\t\t...(request.id !== undefined ? { id: request.id } : {}),\n\t\t\t\tmethod: request.method,\n\t\t\t\tjsonrpc: '2.0',\n\t\t\t\terror: {\n\t\t\t\t\tcode: err.code,\n\t\t\t\t\tmessage: err.message,\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t\treturn response.value\n\t})\n}\n","/**\n * @param {import('../Client.js').Client} client\n * @param {import('@tevm/errors').BaseError} error\n * @param {import('http').ServerResponse} res\n * @param {{method: string, id?: string | undefined | null | number}} [jsonRpcReq]\n * @returns {void}\n * @throws {never}\n */\nexport const handleError = (client, error, res, jsonRpcReq = { method: 'unknown' }) => {\n\tclient.transport.tevm.logger.error(error)\n\tres.writeHead(400, { 'Content-Type': 'application/json' })\n\tres.end(\n\t\tJSON.stringify({\n\t\t\t...(jsonRpcReq.id ? { id: jsonRpcReq.id } : {}),\n\t\t\tmethod: jsonRpcReq.method,\n\t\t\tjsonrpc: '2.0',\n\t\t\terror: {\n\t\t\t\tcode: error.code,\n\t\t\t\tmessage: error.message,\n\t\t\t},\n\t\t}),\n\t)\n}\n","import { InvalidRequestError } from '@tevm/errors'\nimport { treeifyError, z } from 'zod'\nimport { InvalidJsonError } from '../errors/InvalidJsonError.js'\n\nconst zJsonRpcRequest = z.object({\n\tjsonrpc: z.literal('2.0').optional(),\n\tid: z.union([z.string(), z.number(), z.null()]).optional(),\n\tmethod: z.string(),\n\tparams: z.unknown().optional(),\n})\n\nconst zBulkRequest = z.array(zJsonRpcRequest)\n\n/**\n * Parses a request body into a JSON-RPC request object.\n * Returns error if any\n * @param {string} body\n * @throws {never} returns errors as values\n */\nexport const parseRequest = (body) => {\n\t/**\n\t * @type {unknown}\n\t */\n\tlet raw\n\ttry {\n\t\traw = JSON.parse(body)\n\t} catch (e) {\n\t\tconst err = /** @type {Error} */ (e)\n\t\treturn new InvalidJsonError(err.message, { cause: err })\n\t}\n\n\tif (Array.isArray(raw)) {\n\t\tconst parsedRequest = zBulkRequest.safeParse(raw)\n\t\tif (!parsedRequest.success) {\n\t\t\treturn new InvalidRequestError(JSON.stringify(treeifyError(parsedRequest.error)))\n\t\t}\n\t\treturn parsedRequest.data\n\t} else {\n\t\tconst parsedRequest = zJsonRpcRequest.safeParse(raw)\n\t\tif (!parsedRequest.success) {\n\t\t\treturn new InvalidRequestError(JSON.stringify(treeifyError(parsedRequest.error)))\n\t\t}\n\t\treturn parsedRequest.data\n\t}\n}\n","import { tevmSend } from '@tevm/decorators'\nimport { InternalError, InvalidRequestError, MethodNotFoundError, UnsupportedProviderMethodError } from '@tevm/errors'\nimport { InvalidJsonError } from './errors/InvalidJsonError.js'\nimport { ReadRequestBodyError } from './errors/ReadRequestBodyError.js'\nimport { getRequestBody } from './internal/getRequestBody.js'\nimport { handleBulkRequest } from './internal/handleBulkRequest.js'\nimport { handleError } from './internal/handleError.js'\nimport { parseRequest } from './internal/parseRequest.js'\n\n/**\n/**\n* Creates a Node.js http handler for handling JSON-RPC requests with Ethereumjs EVM\n* Any unimplemented methods will be proxied to the given proxyUrl\n* This handler works for any server that supports the Node.js http module\n* @param {import('./Client.js').Client} client\n* @returns {import('http').RequestListener}\n* @throws {never}\n* @example\n* import { createHttpHandler } from 'tevm/server'\n* import { createTevm } from 'tevm'\n* import { createServer } from 'http'\n*\n* const PORT = 8080\n*\n* const tevm = createTevm({\n*   fork: {\n*     transport: http('https://mainnet.optimism.io')({})\n*   }\n* })\n*\n* const server = createServer(\n*   createHttpHandler(tevm)\n* )\n* server.listen(PORT, () => console.log({ listening: PORT }))\n*\n*/\nexport const createHttpHandler = (client) => {\n\t/**\n\t * @param {import('http').IncomingMessage} req\n\t * @param {import('http').ServerResponse} res\n\t * @returns {Promise<void>}\n\t */\n\treturn async (req, res) => {\n\t\tconst body = await getRequestBody(req)\n\t\tif (body instanceof ReadRequestBodyError) {\n\t\t\treturn handleError(client, body, res)\n\t\t}\n\n\t\tconst parsedRequest = parseRequest(body)\n\t\tif (parsedRequest instanceof InvalidJsonError || parsedRequest instanceof InvalidRequestError) {\n\t\t\treturn handleError(client, parsedRequest, res)\n\t\t}\n\n\t\tif (Array.isArray(parsedRequest)) {\n\t\t\tconst responses = await handleBulkRequest(client, /** @type {any}*/ (parsedRequest))\n\t\t\tres.writeHead(200, { 'Content-Type': 'application/json' })\n\t\t\tres.end(JSON.stringify(responses))\n\t\t\treturn\n\t\t}\n\n\t\tconst response = await client.transport.tevm\n\t\t\t.extend(tevmSend())\n\t\t\t.send(/** @type any*/ (parsedRequest))\n\t\t\t.catch((e) => {\n\t\t\t\tconsole.log('e', e)\n\t\t\t\treturn 'code' in e ? e : new InternalError('Unexpeced error', { cause: e })\n\t\t\t})\n\n\t\tif ('code' in response && 'message' in response) {\n\t\t\treturn handleError(client, response, res, parsedRequest)\n\t\t}\n\t\tif (\n\t\t\tresponse.error?.code === UnsupportedProviderMethodError.code ||\n\t\t\tresponse.error?.code === MethodNotFoundError.code\n\t\t) {\n\t\t\treturn handleError(client, response.error, res, parsedRequest)\n\t\t}\n\n\t\tconsole.log('response', response)\n\t\tres.writeHead(200, { 'Content-Type': 'application/json' })\n\t\tres.end(JSON.stringify(response))\n\t\treturn\n\t}\n}\n","import { createHttpHandler } from '../createHttpHandler.js'\n\n/**\n * Creates express middleware for a Tevm JSON-RPC server\n * @param {import('../Client.js').Client} client\n * @returns {import('express').RequestHandler}\n * @example\n * ```typescript\n * import express from 'express'\n * import { createExpressMiddleware } from 'tevm/server'\n * import { createMemoryClient } from 'tevm'\n *\n * const tevm = createMemoryClient()\n *\n * const app = express()\n * app.use(express.json())\n * app.use(createExpressMiddleware({ request: tevm.request }))\n * app.listen(8080, () => console.log('listening on 8080'))\n * ```\n *\n * After creating an express server it can be interacted with using any JSON-RPC client\n * including viem, ethers or the built in tevm client\n * ```typescript\n * import { createClient } from 'tevm/client'\n *\n * const client = createClient({\n *  url: 'http://localhost:8080'\n *  })\n *\n *  const blockNumber = await client.eth.getBlockNumber()\n *  const chainId = await client.eth.getChainId()\n *  ```\n */\nexport function createExpressMiddleware(client) {\n\tconst handler = createHttpHandler(client)\n\treturn async (req, res) => {\n\t\thandler(req, res)\n\t}\n}\n","import { createHttpHandler } from '../createHttpHandler.js'\n\n/**\n * Creates a Next.js API handler for a Tevm JSON-RPC server\n * @param {import('../Client.js').Client} client\n * @returns {import('next').NextApiHandler}\n * @example\n * ```typescript\n * import { createNextApiHandler } from 'tevm/server'\n * import { createMemoryClient } from 'tevm'\n *\n * const tevm = createMemoryClient()\n * export default createNextApiHandler({ request: tevm.request })\n * ```\n */\nexport const createNextApiHandler = (client) => {\n\tconst handler = createHttpHandler(client)\n\treturn async (req, res) => {\n\t\thandler(req, res)\n\t}\n}\n","import { createServer as httpCreateServer } from 'node:http'\nimport { createHttpHandler } from './createHttpHandler.js'\n\n/**\n * Creates a lightweight http server for handling requests\n * @param {import('@tevm/memory-client').MemoryClient} client\n * @param {import('http').ServerOptions} [serverOptions] - Optional options to pass to the http server\n * @returns {import('http').Server}\n * To use pass in the Tevm['request'] request handler\n * @throws {CreateServerError}\n * @example\n * ```typescript\n * import { createMemoryClient } from 'tevm'\n * import { createServer } from 'tevm/server'\n *\n * const tevm = createMemoryClient()\n *\n * const server = createServer({\n *   request: tevm.request,\n * })\n *\n * server.listen(8080, () => console.log('listening on 8080'))\n * ```\n * To interact with the HTTP server you can create a Tevm client\n * @example\n * ```typescript\n * import { createTevmClient } from '@tevm/client'\n *\n * const client = createTevmClient()\n * ```\n */\nexport const createServer = (client, serverOptions = {}) => {\n\treturn httpCreateServer(serverOptions, createHttpHandler(client))\n}\n"]}