export { loadBalance, rateLimit } from '@ponder/utils';
import * as viem from 'viem';
export { http, webSocket } from 'viem';

/**
 * Helper type for creating JSON-RPC request types
 */
type JsonRpcRequest<TMethod extends string, TParams> = {
    readonly jsonrpc: '2.0';
    readonly method: TMethod;
    readonly id?: string | number | null;
} & (TParams extends readonly [] ? {
    readonly params?: TParams;
} : {
    readonly params: TParams;
});

type JsonRpcResponse<TMethod extends string, TResult, TErrorCode extends string | number> = {
    jsonrpc: '2.0';
    method: TMethod;
    result: TResult;
    id?: string | number | null;
    error?: never;
} | {
    jsonrpc: '2.0';
    method: TMethod;
    error: {
        code: TErrorCode;
        message: string;
    };
    id?: string | number | null;
    result?: never;
};

type JsonRpcProcedure<TMethod extends string, TParams, TResult, TErrorCode extends string | number> = (request: JsonRpcRequest<TMethod, TParams>) => Promise<JsonRpcResponse<TMethod, TResult, TErrorCode>>;

/**
 * A client for making JsonRpc requests over http
 */
type JsonRpcClient = {
    request: JsonRpcProcedure<string, unknown, unknown, string | number>;
};

declare function createJsonRpcFetcher(client: {
    request: viem.EIP1193RequestFn;
}): JsonRpcClient;

/**
 * The headers interface of the Fetch API
 */
type HeadersInit = string[][] | Record<string, string | ReadonlyArray<string>> | Headers;

export { type HeadersInit, type JsonRpcClient, type JsonRpcProcedure, type JsonRpcRequest, type JsonRpcResponse, createJsonRpcFetcher };
