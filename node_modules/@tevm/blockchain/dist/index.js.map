{"version":3,"sources":["../src/actions/putBlock.js","../src/utils/CUSTOM_Tx_TYPES.js","../src/utils/isTevmBlockTag.js","../src/utils/warnOnce.js","../src/utils/getBlockFromRpc.js","../src/createBaseChain.js","../src/actions/deepCopy.js","../src/actions/getCanonicalHeadBlock.js","../src/actions/getBlock.js","../src/actions/delBlock.js","../src/actions/getIteratorHead.js","../src/actions/setIteratorHead.js","../src/actions/shallowCopy.js","../src/actions/validateHeader.js","../src/actions/getBlockByTag.js","../src/createChain.js"],"names":["bytesToHex","InvalidBlockError","UnknownBlockError","hexToBytes","block"],"mappings":"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","file":"index.js","sourcesContent":["import { bytesToHex } from 'viem'\n\n/**\n * @param {import('../BaseChain.js').BaseChain} baseChain\n * @returns {import('../Chain.js').Chain['putBlock']}\n */\nexport const putBlock = (baseChain) => (block) => {\n\tif (block.common.ethjsCommon.chainId() !== baseChain.common.ethjsCommon.chainId()) {\n\t\tthrow new Error('Block does not match the chainId of common')\n\t}\n\t// skipping validating the blocks\n\t// skipping validating consensus\n\tbaseChain.blocks.set(bytesToHex(block.hash()), block)\n\tbaseChain.blocksByNumber.set(block.header.number, block)\n\tconst latestBlock = baseChain.blocksByTag.get('latest')\n\tbaseChain.logger.debug(block.hash(), 'Saved new block')\n\tif (latestBlock === undefined || latestBlock.header.number <= block.header.number) {\n\t\tbaseChain.logger.debug(block.header.toJSON().number, 'New highest block height. Setting block at latest')\n\t\tbaseChain.blocksByTag.set('latest', block)\n\t}\n\treturn Promise.resolve()\n}\n","/**\n * Array of custom transaction type identifiers for L2 (Layer 2) chains\n *\n * These transaction types are specific to different L2 solutions like Optimism and Arbitrum,\n * which extend Ethereum's transaction types (EIP-2718) with their own custom types for\n * special operations like deposits or cross-layer communications.\n *\n * Used for recognizing and correctly handling these non-standard transaction types\n * when processing blocks from different L2 networks.\n *\n * @example\n * ```typescript\n * import { customTxTypes } from '@tevm/blockchain'\n *\n * // Check if a transaction type is a known L2-specific type\n * function isCustomL2TxType(txType) {\n *   return customTxTypes.includes(txType)\n * }\n *\n * // Handle transaction type appropriately\n * function processTransaction(tx) {\n *   if (isCustomL2TxType(tx.type)) {\n *     console.log(`Processing L2-specific tx type: ${tx.type}`)\n *     // Apply special L2 handling based on type\n *   } else {\n *     // Handle standard Ethereum transaction\n *   }\n * }\n * ```\n */\nexport const customTxTypes = [\n\t'0x4', // EIP-7702 EOA Code tx (not yet supported)\n\t'0x7e', // Optimism deposit tx\n\t'0x6a', // ArbitrumDepositTxType\n\t'0x6b', // ArbitrumUnsignedTxType\n\t'0x6c', // ArbitrumContractTxType\n\t'0x6d', // ArbitrumRetryTxType\n\t'0x6e', // ArbitrumSubmitRetryableTxType\n\t'0x6f', // ArbitrumInternalTxType\n]\n","/**\n * @typedef {'latest' | 'earliest' | 'pending' | 'safe' | 'finalized' | 'forked'} TevmBlockTag\n */\n\n/**\n * All supported block tags for tevm by tag\n * Note these are supported by type but may not be on the given tevm client\n * @type {Array<TevmBlockTag>}\n */\nconst tevmBlockTags = ['latest', 'earliest', 'pending', 'safe', 'finalized', 'forked']\n\n/**\n * Determines if an unknown type is a valid block tag\n * @param {unknown} blockTag\n * @returns {blockTag is TevmBlockTag} true if valid block tag\n */\nexport function isTevmBlockTag(blockTag) {\n\treturn typeof blockTag === 'string' && tevmBlockTags.includes(/** @type {TevmBlockTag}*/ (blockTag))\n}\n","/**\n * Creates a function that logs a warning once\n * @param {import('../BaseChain.js').BaseChain} baseChain\n */\nexport const warnOnce = (baseChain) => {\n\tlet i = 0\n\t/**\n\t * @param {import('viem').RpcBlock} tx\n\t * @returns {void}}\n\t */\n\treturn (tx) => {\n\t\tif (i > 0) {\n\t\t\treturn\n\t\t}\n\t\ti++\n\t\tbaseChain.logger.warn(\n\t\t\t`Warning: EIP-7702, Optimism and Arbitrum deposit transactions (types 0x4, 0x7e and 0x6a-0x6f) are currently not supported and will be filtered out of blocks until support is added\nfiltering out tx ${/** @type {import('viem').RpcBlock}*/ (tx).hash}.\nNote: The block hash will be different because of the excluded txs`,\n\t\t)\n\t}\n}\n","import { Block, blockFromRpc } from '@tevm/block'\nimport { InvalidBlockError, UnknownBlockError } from '@tevm/errors'\nimport { createJsonRpcFetcher } from '@tevm/jsonrpc'\nimport { numberToHex } from '@tevm/utils'\nimport { withRetry } from 'viem'\nimport { customTxTypes } from './CUSTOM_Tx_TYPES.js'\nimport { isTevmBlockTag } from './isTevmBlockTag.js'\nimport { warnOnce } from './warnOnce.js'\n\n/**\n * @param {import('../BaseChain.js').BaseChain} baseChain\n * @param {object} params\n * @param {{request: import('viem').EIP1193RequestFn}} params.transport\n * @param {bigint | import('viem').BlockTag | import('viem').Hex} [params.blockTag]\n * @param {import('@tevm/common').Common} common\n */\nexport const getBlockFromRpc = async (baseChain, { transport, blockTag = 'latest' }, common) => {\n\tconst doWarning = warnOnce(baseChain)\n\tconst fetcher = createJsonRpcFetcher(transport)\n\t/**\n\t * @param {import('viem').RpcBlock<import('viem').BlockTag, true>} rpcBlock\n\t * @returns {[Block, import('viem').RpcBlock<import('viem').BlockTag, true>]}\n\t */\n\tconst asEthjsBlock = (rpcBlock) => {\n\t\treturn [\n\t\t\tblockFromRpc(\n\t\t\t\t{\n\t\t\t\t\t.../** @type {any}*/ (rpcBlock),\n\t\t\t\t\t// filter out transactions we don't support as a hack\n\t\t\t\t\ttransactions: rpcBlock.transactions?.filter((tx) => {\n\t\t\t\t\t\tif (customTxTypes.includes(tx.type)) {\n\t\t\t\t\t\t\tdoWarning(/** @type {any}*/ (tx))\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (tx.type === '0x3' && tx.blobVersionedHashes && tx.blobVersionedHashes.length > 6) {\n\t\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t\t`Filtering out blob transaction ${tx.hash} with ${tx.blobVersionedHashes.length} blobs (maximum is 6). See https://github.com/evmts/tevm-monorepo/issues/1710`,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn true\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tcommon,\n\t\t\t\t\tsetHardfork: false,\n\t\t\t\t\tfreeze: false,\n\t\t\t\t\tskipConsensusFormatValidation: true,\n\t\t\t\t},\n\t\t\t),\n\t\t\trpcBlock,\n\t\t]\n\t}\n\n\treturn withRetry(\n\t\tasync () => {\n\t\t\t// TODO handle errors from fetch better\n\t\t\tif (typeof blockTag === 'bigint') {\n\t\t\t\tconst { result, error } =\n\t\t\t\t\t/** @type {{result: import('viem').RpcBlock<'latest', true>, error: {code: number | string, message: string}}}*/ (\n\t\t\t\t\t\tawait fetcher.request({\n\t\t\t\t\t\t\tjsonrpc: '2.0',\n\t\t\t\t\t\t\tid: 1,\n\t\t\t\t\t\t\tmethod: 'eth_getBlockByNumber',\n\t\t\t\t\t\t\tparams: [numberToHex(blockTag), true],\n\t\t\t\t\t\t})\n\t\t\t\t\t)\n\t\t\t\tif (error) {\n\t\t\t\t\t// TODO we should handle this error code better\n\t\t\t\t\tthrow error\n\t\t\t\t}\n\t\t\t\tif (!result) {\n\t\t\t\t\tthrow new UnknownBlockError('No block found')\n\t\t\t\t}\n\t\t\t\treturn asEthjsBlock(result)\n\t\t\t}\n\t\t\tif (typeof blockTag === 'string' && blockTag.startsWith('0x')) {\n\t\t\t\tconst { result, error } = await fetcher.request({\n\t\t\t\t\tjsonrpc: '2.0',\n\t\t\t\t\tid: 1,\n\t\t\t\t\tmethod: 'eth_getBlockByHash',\n\t\t\t\t\tparams: [blockTag, true],\n\t\t\t\t})\n\t\t\t\tif (error) {\n\t\t\t\t\tthrow error\n\t\t\t\t}\n\t\t\t\tif (!result) {\n\t\t\t\t\tthrow new UnknownBlockError('No block found')\n\t\t\t\t}\n\t\t\t\treturn asEthjsBlock(/** @type {any}*/ (result))\n\t\t\t}\n\t\t\tif (isTevmBlockTag(blockTag)) {\n\t\t\t\t// TODO add an isBlockTag helper\n\t\t\t\tconst { result, error } = await fetcher.request({\n\t\t\t\t\tjsonrpc: '2.0',\n\t\t\t\t\tid: 1,\n\t\t\t\t\tmethod: 'eth_getBlockByNumber',\n\t\t\t\t\tparams: [blockTag, true],\n\t\t\t\t})\n\t\t\t\tif (error) {\n\t\t\t\t\tthrow error\n\t\t\t\t}\n\t\t\t\tif (!result) {\n\t\t\t\t\tthrow new UnknownBlockError('No block found')\n\t\t\t\t}\n\t\t\t\treturn asEthjsBlock(/** @type {any}*/ (result))\n\t\t\t}\n\t\t\tthrow new InvalidBlockError(`Invalid blocktag ${blockTag}`)\n\t\t},\n\t\t{\n\t\t\tretryCount: 3,\n\t\t\tdelay: ({ count }) => {\n\t\t\t\treturn count * 200\n\t\t\t},\n\t\t},\n\t)\n}\n","import { createBlock } from '@tevm/block'\nimport { createLogger } from '@tevm/logger'\nimport { EMPTY_STATE_ROOT } from '@tevm/trie'\nimport { hexToBytes } from 'viem'\nimport { putBlock } from './actions/putBlock.js'\nimport { getBlockFromRpc } from './utils/getBlockFromRpc.js'\n\n/**\n * Keccak-256 hash of the RLP of null\n */\nconst KECCAK256_RLP_S = '0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421'\n/**\n * Keccak-256 hash of the RLP of null\n */\nconst KECCAK256_RLP = hexToBytes(KECCAK256_RLP_S)\n\n/**\n * Creates a genesis {@link Block} for the blockchain with params from {@link Common.genesis}\n * @param {Uint8Array} stateRoot The genesis stateRoot\n * @param {import('@tevm/common').Common} common class\n * @returns {import('@tevm/block').Block}\n */\nconst createGenesisBlock = (stateRoot, common) => {\n\tconst newCommon = common.copy()\n\tnewCommon.ethjsCommon.setHardforkBy({\n\t\tblockNumber: 0,\n\t\ttimestamp: newCommon.ethjsCommon.genesis().timestamp ?? 0,\n\t})\n\n\t/**\n\t * @type {import('@tevm/block').HeaderData}\n\t */\n\tconst header = {\n\t\t...newCommon.ethjsCommon.genesis(),\n\t\tnumber: 0,\n\t\tstateRoot,\n\t\tgasLimit: 30_000_000n,\n\t\t...(newCommon.ethjsCommon.isActivatedEIP(4895) ? { withdrawalsRoot: KECCAK256_RLP } : {}),\n\t}\n\treturn createBlock({ header, ...(newCommon.ethjsCommon.isActivatedEIP(4895) ? { withdrawals: [] } : {}) }, { common })\n}\n/**\n * @param {import('./ChainOptions.js').ChainOptions} options\n * @returns {import('./BaseChain.js').BaseChain} Base chain object\n */\nexport const createBaseChain = (options) => {\n\tconst logger = createLogger({\n\t\tname: '@tevm/blockchain',\n\t\tlevel: options.loggingLevel ?? 'warn',\n\t})\n\t/**\n\t * @type {import('./BaseChain.js').BaseChain}\n\t */\n\tconst chain = {\n\t\tlogger,\n\t\toptions,\n\t\tcommon: options.common,\n\t\tblocks: new Map(),\n\t\tblocksByTag: new Map(),\n\t\tblocksByNumber: new Map(),\n\t\tready: () => genesisBlockPromise.then(() => true),\n\t}\n\n\t// Add genesis block and forked block to chain\n\tconst genesisBlockPromise = (async () => {\n\t\tif (options.fork?.transport) {\n\t\t\tconst [block, jsonRpcBlock] = await getBlockFromRpc(chain, options.fork, options.common)\n\t\t\tawait putBlock(chain)(block)\n\t\t\tchain.blocksByTag.set('forked', block)\n\t\t\t// because we are filtering transactions from optimism we must set the block to the optimism hash so parentBlock traversing works\n\t\t\tif (jsonRpcBlock.hash) {\n\t\t\t\tchain.blocks.set(jsonRpcBlock.hash, block)\n\t\t\t}\n\t\t} else {\n\t\t\tawait putBlock(chain)(\n\t\t\t\toptions.genesisBlock ?? createGenesisBlock(options.genesisStateRoot ?? EMPTY_STATE_ROOT, options.common),\n\t\t\t)\n\t\t}\n\t})()\n\n\treturn chain\n}\n","import { createBaseChain } from '../createBaseChain.js'\n\n/**\n * @param {import('../BaseChain.js').BaseChain} baseChain\n * @returns {() => Promise<import('../BaseChain.js').BaseChain>}\n */\nexport const deepCopy = (baseChain) => async () => {\n\tbaseChain.logger.debug('deep copying blockchain...')\n\tawait baseChain.ready()\n\tconst chain = createBaseChain({\n\t\tcommon: baseChain.common.copy(),\n\t})\n\tchain.blocksByTag = new Map(baseChain.blocksByTag.entries())\n\tchain.blocks = new Map(baseChain.blocks.entries())\n\tchain.blocksByNumber = new Map(baseChain.blocksByNumber.entries())\n\treturn chain\n}\n","import { InternalError } from '@tevm/errors'\n\n/**\n * @param {import('../BaseChain.js').BaseChain} baseChain\n * @returns {import('../Chain.js').Chain['getCanonicalHeadBlock']}\n */\nexport const getCanonicalHeadBlock = (baseChain) => async () => {\n\tawait baseChain.ready()\n\tconst block = baseChain.blocksByTag.get('latest')\n\tif (!block) {\n\t\treturn Promise.reject(new InternalError('No cannonical head exists on blockchain'))\n\t}\n\treturn Promise.resolve(block)\n}\n","import { InvalidBlockError, UnknownBlockError } from '@tevm/errors'\nimport { bytesToBigInt, bytesToHex } from '@tevm/utils'\nimport { getBlockFromRpc } from '../utils/getBlockFromRpc.js'\nimport { getCanonicalHeadBlock } from './getCanonicalHeadBlock.js'\nimport { putBlock } from './putBlock.js'\n\n/**\n * An ethereumjs interface method that accepts a block id number or hash and returns the block\n * @param {import('../BaseChain.js').BaseChain} baseChain\n * @returns {import('../Chain.js').Chain['getBlock']}\n */\nexport const getBlock = (baseChain) => async (blockId) => {\n\tconst block = (() => {\n\t\tif (typeof blockId === 'bigint' || typeof blockId === 'number') {\n\t\t\tbaseChain.logger.debug({ blockId: BigInt(blockId) }, 'getting block by number')\n\t\t\treturn baseChain.blocksByNumber.get(BigInt(blockId))\n\t\t}\n\t\tif (blockId instanceof Uint8Array) {\n\t\t\tbaseChain.logger.debug({ blockId: bytesToHex(blockId) }, 'getting block by hash or hex encoded number')\n\t\t\treturn baseChain.blocks.get(bytesToHex(blockId)) ?? baseChain.blocksByNumber.get(bytesToBigInt(blockId))\n\t\t}\n\t\t/**\n\t\t * @type {never}\n\t\t */\n\t\tconst typesafeBlockId = blockId\n\t\tthrow new InvalidBlockError(`Unknown blockid ${typesafeBlockId}`)\n\t})()\n\n\tif (block !== undefined) {\n\t\tbaseChain.logger.debug(block.header.toJSON(), 'Block found in cache')\n\t\treturn block\n\t}\n\n\tif (!baseChain.options.fork?.transport) {\n\t\tthrow new UnknownBlockError(\n\t\t\tblockId instanceof Uint8Array\n\t\t\t\t? `Block with hash ${bytesToHex(blockId)} does not exist`\n\t\t\t\t: `Block number ${blockId} does not exist`,\n\t\t)\n\t}\n\tbaseChain.logger.debug('Fetching block from remote rpc...')\n\n\tconst [fetchedBlock, jsonRpcFetchedBlock] = await getBlockFromRpc(\n\t\tbaseChain,\n\t\t{\n\t\t\ttransport: baseChain.options.fork?.transport,\n\t\t\tblockTag: blockId instanceof Uint8Array ? bytesToHex(blockId) : BigInt(blockId),\n\t\t},\n\t\tbaseChain.common,\n\t)\n\n\tbaseChain.logger.debug(fetchedBlock.header.toJSON(), 'Saving forked block to blockchain')\n\n\tconst forkedBlock = /** @type {import('@tevm/block').Block}*/ (baseChain.blocksByTag.get('forked'))\n\tconst latestBlock = await getCanonicalHeadBlock(baseChain)()\n\tif (fetchedBlock.header.number > forkedBlock.header.number) {\n\t\tthrow new InvalidBlockError(`The fetched block ${fetchedBlock.header.number} has a higher block height than the forked block ${forkedBlock.header.number} but less than the latest block ${latestBlock.header.number}\nThis could indicate a bug in tevm as it implies a block is missing if the internal chain tried fetching it from rpc\nDid you manually delete the block? If not consider opening an issue`)\n\t}\n\n\tawait putBlock(baseChain)(fetchedBlock)\n\n\t// Because we sometimes filter out transactions which affects the hash of the block we need to store the block hash twice otherwise using parent to traverse the chain will fail\n\tif (jsonRpcFetchedBlock?.hash) {\n\t\tbaseChain.blocks.set(jsonRpcFetchedBlock.hash, fetchedBlock)\n\t}\n\n\treturn fetchedBlock\n}\n","import { InvalidBlockError } from '@tevm/errors'\nimport { bytesToHex } from 'viem'\nimport { getBlock } from './getBlock.js'\nimport { getCanonicalHeadBlock } from './getCanonicalHeadBlock.js'\n\n/**\n * Deletes a block from the blockchain\n * @param {import('../BaseChain.js').BaseChain} baseChain\n * @returns {import('../Chain.js').Chain['delBlock']}\n * @throws {InvalidBlockError} If the block is the `forked` block\n */\nexport const delBlock = (baseChain) => async (blockHash) => {\n\tconst block = await getBlock(baseChain)(blockHash)\n\tconst hexHash = bytesToHex(blockHash)\n\n\tconst latest = await getCanonicalHeadBlock(baseChain)()\n\tconst forkedBlock = baseChain.blocksByTag.get('forked')\n\n\tif (forkedBlock && hexHash === bytesToHex(forkedBlock.hash())) {\n\t\tthrow new InvalidBlockError('Cannot delete the forked block!')\n\t}\n\tif (hexHash === bytesToHex(latest.hash())) {\n\t\tconst parent = await getBlock(baseChain)(latest.header.parentHash).catch(() => undefined)\n\t\tbaseChain.blocksByTag.set('latest', parent)\n\t}\n\tbaseChain.blocksByNumber.delete(block.header.number)\n\tbaseChain.blocks.delete(hexHash)\n\tbaseChain.logger.debug({ blockHash }, 'deleted block')\n}\n","import { InvalidBlockError } from '@tevm/errors'\n\n/**\n * @param {import('../BaseChain.js').BaseChain} baseChain\n * @returns {import('../Chain.js').Chain['getIteratorHead']}\n */\nexport const getIteratorHead =\n\t(baseChain) =>\n\t(name = 'vm') => {\n\t\tconst head = baseChain.blocksByTag.get(/** @type {import('viem').BlockTag}*/ (name))\n\t\tif (!head) {\n\t\t\treturn Promise.reject(\n\t\t\t\tnew InvalidBlockError(\n\t\t\t\t\t`No block with tag ${name} exists. Current tags include ${[...baseChain.blocksByTag.keys()].join(',')}`,\n\t\t\t\t),\n\t\t\t)\n\t\t}\n\t\treturn Promise.resolve(head)\n\t}\n","import { bytesToHex } from 'viem'\n\n/**\n * @param {import('../BaseChain.js').BaseChain} baseChain\n * @returns {import('../Chain.js').Chain['setIteratorHead']}\n */\nexport const setIteratorHead = (baseChain) => (tag, headHash) => {\n\tbaseChain.blocksByTag.set(/** @type {import('viem').BlockTag}*/ (tag), baseChain.blocks.get(bytesToHex(headHash)))\n\treturn Promise.resolve()\n}\n","import { createBaseChain } from '../createBaseChain.js'\n\n/**\n * @param {import('../BaseChain.js').BaseChain} baseChain\n * @returns {() => import('../BaseChain.js').BaseChain}\n */\nexport const shallowCopy = (baseChain) => () => {\n\treturn createBaseChain(baseChain.options)\n}\n","import { ConsensusAlgorithm } from '@tevm/common'\nimport { getBlock } from './getBlock.js'\n\n/**\n * @param {import('../BaseChain.js').BaseChain} baseChain\n * @returns {import('../Chain.js').Chain['validateHeader']}\n */\nexport const validateHeader = (baseChain) => async (header, height) => {\n\tif (header.isGenesis()) {\n\t\treturn\n\t}\n\tconst parentHeader = (await getBlock(baseChain)(header.parentHash)).header\n\n\tconst { number } = header\n\tif (number !== parentHeader.number + BigInt(1)) {\n\t\tthrow new Error(`invalid number ${header.errorStr()}`)\n\t}\n\n\tif (header.timestamp <= parentHeader.timestamp) {\n\t\tthrow new Error(`invalid timestamp ${header.errorStr()}`)\n\t}\n\n\tif (baseChain.common.ethjsCommon.consensusType() === 'pow') throw new Error('Tevm currently does not support pow')\n\n\tif (baseChain.common.ethjsCommon.consensusAlgorithm() === ConsensusAlgorithm.Clique) {\n\t\tconst period = /** @type {any}*/ (baseChain.common.ethjsCommon.consensusConfig()).period\n\t\t// Timestamp diff between blocks is lower than PERIOD (clique)\n\t\tif (parentHeader.timestamp + BigInt(period) > header.timestamp) {\n\t\t\tthrow new Error(`invalid timestamp diff (lower than period) ${header.errorStr()}`)\n\t\t}\n\t}\n\n\theader.validateGasLimit(parentHeader)\n\n\tif (height !== undefined) {\n\t\tconst dif = height - parentHeader.number\n\n\t\tif (!(dif < BigInt(8) && dif > BigInt(1))) {\n\t\t\tthrow new Error(`uncle block has a parent that is too old or too young ${header.errorStr()}`)\n\t\t}\n\t}\n\n\t// check blockchain dependent EIP1559 values\n\tif (baseChain.common.ethjsCommon.isActivatedEIP(1559)) {\n\t\t// check if the base fee is correct\n\t\tlet expectedBaseFee\n\t\tconst londonHfBlock = baseChain.common.ethjsCommon.hardforkBlock('london')\n\t\tconst isInitialEIP1559Block = number === londonHfBlock\n\t\tif (isInitialEIP1559Block) {\n\t\t\texpectedBaseFee = baseChain.common.ethjsCommon.param('initialBaseFee')\n\t\t} else {\n\t\t\texpectedBaseFee = parentHeader.calcNextBaseFee()\n\t\t}\n\n\t\tif (header.baseFeePerGas !== expectedBaseFee) {\n\t\t\tthrow new Error(`Invalid block: base fee not correct ${header.errorStr()}`)\n\t\t}\n\t}\n\n\tif (baseChain.common.ethjsCommon.isActivatedEIP(4844)) {\n\t\tconst expectedExcessBlobGas = parentHeader.calcNextExcessBlobGas()\n\t\tif (header.excessBlobGas !== expectedExcessBlobGas) {\n\t\t\tthrow new Error(`expected blob gas: ${expectedExcessBlobGas}, got: ${header.excessBlobGas}`)\n\t\t}\n\t}\n}\n","import { UnknownBlockError } from '@tevm/errors'\nimport { hexToBytes, hexToNumber, isHex } from '@tevm/utils'\nimport { getBlockFromRpc } from '../utils/getBlockFromRpc.js'\nimport { getBlock } from './getBlock.js'\nimport { putBlock } from './putBlock.js'\n\n/**\n * @param {import('../BaseChain.js').BaseChain} baseChain\n * @returns {import('../Chain.js').Chain['getBlockByTag']}\n */\nexport const getBlockByTag = (baseChain) => async (blockId) => {\n\tconst _getBlock = getBlock(baseChain)\n\tif (isHex(blockId)) {\n\t\treturn blockId.length === 66 ? _getBlock(hexToBytes(blockId)) : _getBlock(hexToNumber(blockId))\n\t}\n\tif (typeof blockId === 'number' || typeof blockId === 'bigint' || blockId instanceof Uint8Array) {\n\t\treturn _getBlock(blockId)\n\t}\n\tconst block = baseChain.blocksByTag.get(blockId)\n\tif (!block && baseChain.options.fork?.transport) {\n\t\tconst [block, jsonRpcBlock] = await getBlockFromRpc(\n\t\t\tbaseChain,\n\t\t\t{\n\t\t\t\ttransport: baseChain.options.fork.transport,\n\t\t\t\tblockTag: blockId,\n\t\t\t},\n\t\t\tbaseChain.common,\n\t\t)\n\t\tawait putBlock(baseChain)(block)\n\t\tbaseChain.blocksByTag.set(blockId, block)\n\t\t// because of optimism tx we need to set block hash twice\n\t\tif (jsonRpcBlock.hash) {\n\t\t\tbaseChain.blocks.set(jsonRpcBlock.hash, block)\n\t\t}\n\t\treturn block\n\t}\n\tif (!block) {\n\t\tthrow new UnknownBlockError(blockId)\n\t}\n\treturn block\n}\n","import { CasperConsensus } from '@ethereumjs/blockchain'\nimport { deepCopy } from './actions/deepCopy.js'\nimport { delBlock } from './actions/delBlock.js'\nimport { getBlock } from './actions/getBlock.js'\nimport { getBlockByTag } from './actions/getBlockByTag.js'\nimport { getCanonicalHeadBlock } from './actions/getCanonicalHeadBlock.js'\nimport { getIteratorHead } from './actions/getIteratorHead.js'\nimport { putBlock } from './actions/putBlock.js'\nimport { setIteratorHead } from './actions/setIteratorHead.js'\nimport { shallowCopy } from './actions/shallowCopy.js'\nimport { validateHeader } from './actions/validateHeader.js'\nimport { createBaseChain } from './createBaseChain.js'\n/**\n * @param {import('./ChainOptions.js').ChainOptions} options\n * @returns {Promise<import('./Chain.js').Chain>}\n */\nexport const createChain = async (options) => {\n\t/**\n\t * @param {import('./BaseChain.js').BaseChain} baseChain\n\t * @returns {import('./Chain.js').Chain}\n\t */\n\tconst decorate = (baseChain) => {\n\t\treturn /** @type {import('./Chain.js').Chain} */ (\n\t\t\tObject.assign(baseChain, {\n\t\t\t\tgetBlockByTag: getBlockByTag(baseChain),\n\t\t\t\tdeepCopy: async () => decorate(await deepCopy(baseChain)()),\n\t\t\t\tshallowCopy: () => decorate(shallowCopy(baseChain)()),\n\t\t\t\tgetBlock: getBlock(baseChain),\n\t\t\t\tputBlock: putBlock(baseChain),\n\t\t\t\tvalidateHeader: validateHeader(baseChain),\n\t\t\t\tgetCanonicalHeadBlock: getCanonicalHeadBlock(baseChain),\n\t\t\t\tdelBlock: delBlock(baseChain),\n\t\t\t\tgetIteratorHead: getIteratorHead(baseChain),\n\t\t\t\tsetIteratorHead: setIteratorHead(baseChain),\n\t\t\t\t/**\n\t\t\t\t * Unused but part of interface\n\t\t\t\t * @type {import('@ethereumjs/blockchain').BlockchainInterface['consensus']}\n\t\t\t\t */\n\t\t\t\tconsensus: new CasperConsensus(),\n\t\t\t\t/**\n\t\t\t\t * @type {import('@ethereumjs/blockchain').BlockchainInterface['iterator']}\n\t\t\t\t */\n\t\t\t\titerator: () => {\n\t\t\t\t\tthrow new Error('iterator is not implemented')\n\t\t\t\t},\n\t\t\t})\n\t\t)\n\t}\n\treturn decorate(createBaseChain(options))\n}\n"]}